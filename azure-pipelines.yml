trigger:
  branches:
    include:
      - dev
      - master
      - preview/*
      - releases/*

pr:
  autoCancel: "false"
  branches:
    include:
      - dev
      - master
      - preview/*
      - releases/*

jobs:
- job: build
  pool:
    name: 'Hosted VS2017'  # name of the pool to run this job in
    demands:
      - msbuild
      - vstest
  steps:
    - checkout: self
      clean: true
      submodules: true

    - task: DotNetCoreInstaller@0
      displayName: 'Use .NET Core sdk 2.1.505'
      inputs:
        version: 2.1.505

    - task: DotNetCoreCLI@2
      displayName: 'Restore'
      inputs:
        command: restore
        feedsToUse: config
        nugetConfigPath: NuGet.Config

    - task: MSBuild@1
      displayName: 'Build IIS Administration'
      inputs:
        solution: Microsoft.IIS.Administration.sln
        msbuildVersion: "15.0"
        msbuildArchitecture: x64
        configuration: 'release'
        msbuildArguments: '/t:publish'

    - task: PowerShell@2
      displayName: 'PowerShell Script build.ps1'
      inputs:
        targetType: filePath
        filePath: ./build.ps1
        arguments: '-devSetup -install -test -verbose'
